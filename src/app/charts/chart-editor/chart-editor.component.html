<nz-layout style="height: 100%">
  <nz-sider class="left-sider" nzTheme="light">
    <span class="block-title">Stitches</span>
    <div class="stitch-inventory" nz-flex nzGap="middle" nzWrap="wrap">
      @for (atomicStitch of atomicStitchInventory; track atomicStitch.type) {
          <app-stitch [stitch]="atomicStitch" [colors]="colorPaletteForm" [showDescription]="true" (click)="stitchSelected(atomicStitch)"></app-stitch>
      }
    </div>
    <span class="block-title">Composite stitches</span>
    <nz-divider nzPlain nzText="Cable stitches" nzOrientation="left"></nz-divider>
    <app-stitch [stitch]="cableStitch1" [colors]="colorPaletteForm" [showDescription]="true"></app-stitch>
    <nz-divider nzPlain nzText="Wrapped stitches" nzOrientation="left"></nz-divider>
  </nz-sider>
  <nz-layout class="inner-layout">
    <nz-content>
      @if (chartForm && colorPaletteForm) {
        <app-chart-block [chartForm]="chartForm" [colors]="colorPaletteForm" (stitchEvent)="stitchEvent($event)"></app-chart-block>
        <app-color-palette class="color-palette" [colors]="colorPaletteForm" [allowSelectMode]="true" [editorMode]="colorPaletteEditorMode" (colorSelected)="colorSelected($event)"></app-color-palette>
      }
      @if (selectedStitch) {
        <div class="selected-element">
          <nz-card nz-row>
            <div nz-col>
              <app-stitch [stitch]="selectedStitch" [colors]="colorPaletteForm" [size]="30"></app-stitch>
            </div>
            <div nz-col>
              {{
                selectedStitch | patternDescription : selectedStitchTrigger
              }}
            </div>
          </nz-card>
        </div>
      }
    </nz-content>
  </nz-layout>
  <nz-sider nzWidth="400px" nzTheme="light">
    @if (chartForm) {
      <form nz-form [formGroup]="chartForm">
        <nz-form-item>
          <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>Title</nz-form-label>
          <nz-form-control [nzSm]="16" [nzXs]="24">
            <input nz-input formControlName="title" placeholder="Title" type="text" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>Description</nz-form-label>
          <nz-form-control [nzSm]="16" [nzXs]="24">
            <input nz-input formControlName="description" placeholder="Description" type="text" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>Size</nz-form-label>
          <nz-form-control [nzSm]="16" [nzXs]="24">
            <nz-space-compact nzBlock>
              <nz-input-number
                formControlName="width"
                (change)="onWidthChange()"
                placeholder="Width"
                [nzControls]="false"
                [nzMin]="1"
                [nzMax]="30"
                style="width: 50px; text-align: center;"
                nz-popconfirm
                [nzPopconfirmTrigger]="null"
                [nzPopconfirmVisible]="confirmNewWidthPopconfirmVisible"
                nzPopconfirmTitle="Are you sure you want to decrease the width of this chart?"
                nzPopconfirmPlacement="bottom"
                (nzOnConfirm)="confirmNewWidth()"
                (nzOnCancel)="cancelNewWidth()"
              />
              <input
                type="text"
                disabled
                nz-input
                placeholder="Ã—"
                class="demo-input-split"
                style="width: 30px; border-left: 0px; border-right: 0px; pointer-events: none; background-color: rgb(255, 255, 255);"
              />
              <nz-input-number
                formControlName="height"
                (change)="onHeightChange()"
                placeholder="Height"
                [nzControls]="false"
                [nzMin]="1"
                [nzMax]="30"
                style="width:50px; text-align: center; border-left-width: 0px;"
                nz-popconfirm
                [nzPopconfirmTrigger]="null"
                [nzPopconfirmVisible]="confirmNewHeightPopconfirmVisible"
                nzPopconfirmTitle="Are you sure you want to decrease the height of this chart?"
                nzPopconfirmPlacement="bottom"
                (nzOnConfirm)="confirmNewHeight()"
                (nzOnCancel)="cancelNewHeight()"
                />
            </nz-space-compact>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>Knitted flat</nz-form-label>
          <nz-form-control [nzSm]="16" [nzXs]="24">
            <nz-switch formControlName="isFlat" nzSize="small"></nz-switch>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>
            Tags
          </nz-form-label>
          <nz-form-control [nzSm]="16" [nzXs]="24">

          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSm]="8" [nzXs]="24" nzRequired>
            Image
          </nz-form-label>
          <nz-form-control [nzSm]="16" [nzXs]="24">
            <nz-upload
              [nzLimit]="1"
              [nzAction]="onFileUpload"
            >
            <button nz-button>
              <nz-icon nzType="upload" />
              Click to Upload
            </button>
          </nz-upload>
          </nz-form-control>
        </nz-form-item>

        <button nz-button [nzLoading]="isSaving" nzType="primary" (click)="saveChart()">Save</button>

      </form>
    }
  </nz-sider>
</nz-layout>